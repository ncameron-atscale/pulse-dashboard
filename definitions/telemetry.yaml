---
version: 1
title: Telemetry Dashboard (Tableau Template)
description: Template for building a Tableau dashboard mirroring the app's KPIs and
  visualizations.

connections:
  ats_connection:
    connection:
      type: jdbc
      url: "{baseUrl}/api/v1/telemetry?from={from}&to={to}&segment={segment}"


models:
  telemetry:
    dataSource: ats_connection
    sql:
      tableName: Telemetry
      columns:

        user_hash:
          dataType: string
          label: User Hash
          role: dimension
          type: nominal
          # This field must be title case and will break TWB; needs investigation
          aggregation: None

        m_epoch_sql_wall_time_avg:
          dataType: real
          label: M Epoch Sql Wall Time Avg
          role: measure
          type: quantitative
          # This field must be title case and will break TWB; needs investigation
          aggregation: Avg

        m_subquery_count_sum:
          dataType: integer
          label: M Subquery Count Sum
          role: measure
          type: quantitative
          aggregation: Sum

        query_hour:
          dataType: datetime
          label: Query Hour
          role: dimension
          type: ordinal
          aggregation: None

        organization_id:
          dataType: string
          label: Organization Id
          role: dimension
          type: nominal
          aggregation: None

        cube_name:
          dataType: string
          label: Cube Name
          role: dimension
          type: nominal
          aggregation: None

        project_id:
          dataType: string
          label: Project Id
          role: dimension
          type: nominal
          aggregation: None

        succeeded:
          dataType: string
          label: Succeeded
          role: dimension
          type: nominal
          aggregation: None

worksheets:
  # Summary Statistics
  summary_total_user_hash:
    title: Summary Statistics
    model: telemetry
    graphType: text
    measures: 
    - user_hash
    - m_subquery_count_sum
    - m_epoch_sql_wall_time_avg
    - m_subquery_count_sum

    labels:  
    - "Total UserHash"
    - "Total Subquery Count"
    - "Total Avg Wall Time"
    - "Total Avg Wall Time"
    

  summary_total_org_id:
    title: Total OrganizationalId
    model: telemetry
    graphType: text
    xAxis: organization_id
    yAxis: m_subquery_count_sum

  summary_total_cube_names:
    title: Total CubeNames
    model: telemetry
    graphType: text
    xAxis: cube_name
    yAxis: m_subquery_count_sum

  summary_avg_queries_per_day:
    title: Avg TotalQueries/Day
    model: telemetry
    graphType: text
    xAxis: query_hour
    yAxis: m_subquery_count_sum

  summary_success_rate:
    title: Overall Success Rate
    model: telemetry
    graphType: text
    xAxis: succeeded
    yAxis: m_subquery_count_sum

  summary_avg_wall_time:
    title: Overall Avg WallTime
    model: telemetry
    graphType: text
    xAxis: query_hour
    yAxis: m_epoch_sql_wall_time_avg

  # KPI Visuals
  kpi_query_success_rate:
    title: Query Success Rate
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: succeeded

  kpi_total_queries_per_day:
    title: TotalQueries per Day
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: m_subquery_count_sum

  kpi_response_time:
    title: ResponseTime(ms)
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: m_epoch_sql_wall_time_avg

  # Additional Information (Top 10s)
  top_10_active_users:
    title: Top 10 Most Active Users
    model: telemetry
    graphType: bar
    xAxis: m_subquery_count_sum
    yAxis: user_hash

  top_10_cubes_by_avg_wall_time:
    title: Top 10 CubeNames by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: cube_name

  top_10_users_by_avg_wall_time:
    title: Top 10 UserHash by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: user_hash

  top_10_orgs_by_avg_wall_time:
    title: Top 10 OrganizationId by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: organization_id

  top_10_projects_by_avg_wall_time:
    title: Top 10 ProjectId by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: project_id

dashboards:
  # ============================================================================
  # COMPREHENSIVE TELEMETRY DASHBOARD
  # Organized into three tile categories based on Superstore TWB styling
  # ============================================================================
  telemetry_comprehensive:
    title: Telemetry Dashboard
    description: Comprehensive view of telemetry metrics organized by Summary Statistics, KPIs, and Additional Information
    
    # Sizing based on Superstore TWB dashboard patterns (minheight/minwidth)
    size:
      width: 1400
      height: 900
      # Grid: 5 columns x 3 rows to accommodate all worksheets
      hSegments: 5
      vSegments: 3
    
    # Style definitions inspired by Superstore.twb (for documentation/future use)
    # These styles are based on TWB patterns:
    #   - Title: Tableau Bold, 14px, #333333
    #   - Labels: Tableau Regular, 9px, #787878, bold
    #   - Values: Tableau Bold, 12px, #d3872a (accent)
    #   - Container: borderStyle solid, borderColor #d7d7d7, bg #ffffff
    #   - Animation: disabled (ao-off)
    
    tiles:
      # ------------------------------------------
      # ROW 0: Summary Statistics (Top Row)
      # Text-based summary metrics across top
      # ------------------------------------------
      - worksheet: summary_total_user_hash
        x: 0
        y: 0
        category: Summary Statistics
      - worksheet: summary_total_org_id
        x: 1
        y: 0
        category: Summary Statistics
      - worksheet: summary_total_cube_names
        x: 2
        y: 0
        category: Summary Statistics
      - worksheet: summary_avg_queries_per_day
        x: 3
        y: 0
        category: Summary Statistics
      - worksheet: summary_success_rate
        x: 4
        y: 0
        category: Summary Statistics
      
      # ------------------------------------------
      # ROW 1: KPI Visuals (Middle Row)
      # Line charts for key performance indicators
      # Style: markColor #4a76a1 (blue), #d3872a (orange)
      # ------------------------------------------
      - worksheet: kpi_query_success_rate
        x: 0
        y: 1
        category: KPI
      - worksheet: kpi_total_queries_per_day
        x: 2
        y: 1
        category: KPI
      - worksheet: kpi_response_time
        x: 4
        y: 1
        category: KPI
      
      # ------------------------------------------
      # ROW 2: Additional Information (Bottom Row)
      # Bar charts for Top 10 rankings
      # Style: alternating markColor #4a76a1/#d3872a
      # ------------------------------------------
      - worksheet: top_10_active_users
        x: 0
        y: 2
        category: Additional Information
      - worksheet: top_10_cubes_by_avg_wall_time
        x: 1
        y: 2
        category: Additional Information
      - worksheet: top_10_users_by_avg_wall_time
        x: 2
        y: 2
        category: Additional Information
      - worksheet: top_10_orgs_by_avg_wall_time
        x: 3
        y: 2
        category: Additional Information
      - worksheet: top_10_projects_by_avg_wall_time
        x: 4
        y: 2
        category: Additional Information
