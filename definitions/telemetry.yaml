---
version: 1
title: Telemetry Dashboard (Tableau Template)
description: Template for building a Tableau dashboard mirroring the app's KPIs and
  visualizations.

connections:
  ats_connection:
    connection:
      type: jdbc
      url: "{baseUrl}/api/v1/telemetry?from={from}&to={to}&segment={segment}"


models:
  telemetry:
    dataSource: ats_connection
    sql:
      tableName: Telemetry
      columns:

        user_hash:
          dataType: string
          label: User Hash
          role: dimension
          type: nominal
          # This field must be title case and will break TWB; needs investigation
          aggregation: None

        m_epoch_sql_wall_time_avg:
          dataType: real
          label: M Epoch Sql Wall Time Avg
          role: measure
          type: quantitative
          # This field must be title case and will break TWB; needs investigation
          aggregation: Avg

        m_subquery_count_sum:
          dataType: integer
          label: M Subquery Count Sum
          role: measure
          type: quantitative
          aggregation: Sum

        query_hour:
          dataType: datetime
          label: Query Hour
          role: dimension
          type: ordinal
          aggregation: None

        organization_id:
          dataType: string
          label: Organization Id
          role: dimension
          type: nominal
          aggregation: None

        cube_name:
          dataType: string
          label: Cube Name
          role: dimension
          type: nominal
          aggregation: None

        project_id:
          dataType: string
          label: Project Id
          role: dimension
          type: nominal
          aggregation: None

        succeeded:
          dataType: string
          label: Succeeded
          role: dimension
          type: nominal
          aggregation: None

        # Distinct count measures for Summary Statistics
        m_organization_id_distinct:
          dataType: integer
          label: Total Organizations
          role: measure
          type: quantitative
          aggregation: Sum

        m_cube_name_distinct:
          dataType: integer
          label: Total Cubes
          role: measure
          type: quantitative
          aggregation: Sum

        m_user_hash_distinct:
          dataType: integer
          label: Total Users
          role: measure
          type: quantitative
          aggregation: Sum

        # Success percentage (pre-calculated)
        cm_query_success_pct:
          dataType: real
          label: Query Success Rate (%)
          role: measure
          type: quantitative
          aggregation: Avg

        # Daily query count for calculating average queries per day
        m_query_id_count:
          dataType: integer
          label: Total Queries
          role: measure
          type: quantitative
          aggregation: Sum

worksheets:
  # Summary Statistics - Single number displays
  summary_total_orgs:
    title: Total Organizations
    model: telemetry
    graphType: text
    measures:
      - m_organization_id_distinct
    format: "integer"
    description: Count of unique organization_id values

  summary_total_cubes:
    title: Total Cubes
    model: telemetry
    graphType: text
    measures:
      - m_cube_name_distinct
    format: "integer"
    description: Count of unique cube_name values

  summary_total_users:
    title: Total Users
    model: telemetry
    graphType: text
    measures:
      - m_user_hash_distinct
    format: "integer"
    description: Count of unique user_hash values

  summary_avg_queries_per_day:
    title: Avg Queries/Day
    model: telemetry
    graphType: text
    measures:
      - m_query_id_count
    format: "decimal:2"
    description: Daily average of TotalQueries over the entire time period

  summary_success_rate:
    title: Success Rate (%)
    model: telemetry
    graphType: text
    measures:
      - cm_query_success_pct
    format: "percent:2"
    description: Percentage of succeeded queries to two decimal places

  summary_avg_wall_time:
    title: Avg WallTime (ms)
    model: telemetry
    graphType: text
    measures:
      - m_epoch_sql_wall_time_avg
    format: "decimal:2"
    description: Average WallTime to two decimal places

  # KPI Visuals
  kpi_query_success_rate:
    title: Query Success Rate
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: succeeded

  kpi_total_queries_per_day:
    title: TotalQueries per Day
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: m_subquery_count_sum

  kpi_response_time:
    title: ResponseTime(ms)
    model: telemetry
    graphType: line
    xAxis: query_hour
    yAxis: m_epoch_sql_wall_time_avg

  # Additional Information (Top 10s)
  top_10_active_users:
    title: Top 10 Most Active Users
    model: telemetry
    graphType: bar
    xAxis: m_subquery_count_sum
    yAxis: user_hash

  top_10_cubes_by_avg_wall_time:
    title: Top 10 CubeNames by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: cube_name

  top_10_users_by_avg_wall_time:
    title: Top 10 UserHash by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: user_hash

  top_10_orgs_by_avg_wall_time:
    title: Top 10 OrganizationId by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: organization_id

  top_10_projects_by_avg_wall_time:
    title: Top 10 ProjectId by AvgWallTime
    model: telemetry
    graphType: bar
    xAxis: m_epoch_sql_wall_time_avg
    yAxis: project_id

dashboards:
  # ============================================================================
  # COMPREHENSIVE TELEMETRY DASHBOARD
  # Organized into three tile categories based on Superstore TWB styling
  # ============================================================================
  telemetry_comprehensive:
    title: Telemetry Dashboard
    description: Comprehensive view of telemetry metrics organized by Summary Statistics, KPIs, and Additional Information
    
    # Sizing based on Superstore TWB dashboard patterns (minheight/minwidth)
    size:
      width: 1680
      height: 900
      # Grid: 6 columns x 3 rows to accommodate all worksheets
      hSegments: 6
      vSegments: 3
    
    # Style definitions inspired by Superstore.twb (for documentation/future use)
    # These styles are based on TWB patterns:
    #   - Title: Tableau Bold, 14px, #333333
    #   - Labels: Tableau Regular, 9px, #787878, bold
    #   - Values: Tableau Bold, 12px, #d3872a (accent)
    #   - Container: borderStyle solid, borderColor #d7d7d7, bg #ffffff
    #   - Animation: disabled (ao-off)
    
    tiles:
      # ------------------------------------------
      # ROW 0: Summary Statistics (Top Row)
      # Text-based summary metrics across top
      # ------------------------------------------
      - worksheet: summary_total_orgs
        x: 0
        y: 0
        category: Summary Statistics
      - worksheet: summary_total_cubes
        x: 1
        y: 0
        category: Summary Statistics
      - worksheet: summary_total_users
        x: 2
        y: 0
        category: Summary Statistics
      - worksheet: summary_avg_queries_per_day
        x: 3
        y: 0
        category: Summary Statistics
      - worksheet: summary_success_rate
        x: 4
        y: 0
        category: Summary Statistics
      - worksheet: summary_avg_wall_time
        x: 5
        y: 0
        category: Summary Statistics
      
      # ------------------------------------------
      # ROW 1: KPI Visuals (Middle Row)
      # Line charts for key performance indicators
      # Style: markColor #4a76a1 (blue), #d3872a (orange)
      # ------------------------------------------
      - worksheet: kpi_query_success_rate
        x: 0
        y: 1
        category: KPI
      - worksheet: kpi_total_queries_per_day
        x: 2
        y: 1
        category: KPI
      - worksheet: kpi_response_time
        x: 4
        y: 1
        category: KPI
      
      # ------------------------------------------
      # ROW 2: Additional Information (Bottom Row)
      # Bar charts for Top 10 rankings
      # Style: alternating markColor #4a76a1/#d3872a
      # ------------------------------------------
      - worksheet: top_10_active_users
        x: 0
        y: 2
        category: Additional Information
      - worksheet: top_10_cubes_by_avg_wall_time
        x: 1
        y: 2
        category: Additional Information
      - worksheet: top_10_users_by_avg_wall_time
        x: 2
        y: 2
        category: Additional Information
      - worksheet: top_10_orgs_by_avg_wall_time
        x: 3
        y: 2
        category: Additional Information
      - worksheet: top_10_projects_by_avg_wall_time
        x: 4
        y: 2
        category: Additional Information
